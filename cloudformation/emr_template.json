{
  "AWSTemplateFormatVersion":"2010-09-09",
  "Description":"Best Practice EMR Cluster for hive hue",
  "Parameters":{
    "EMRClusterName":{
      "Description":"Name of the cluster",
      "Type":"String",
      "Default":"aidatagov"
    },
    "KeyName":{
      "Type":"AWS::EC2::KeyPair::KeyName",
      "Description":"Must be a valid Key Pair nam"
    },
	"CoreInstanceType111":{
		"Type":"AWS::EMR::Cluster::InstanceType"
	},
    "CoreInstanceType":{
      "Description":"Instance type to be used for core instances.",
      "Type":"String",
      "AllowedValues":[
        "m1.medium",
        "m1.large",
        "m1.xlarge",
        "m3.xlarge",
        "m3.2xlarge",
        "m4.large",
        "m4.xlarge",
        "m4.2xlarge",
        "m4.4xlarge",
        "m4.10xlarge",
        "m4.16xlarge",
        "c3.xlarge",
        "c3.2xlarge",
        "c3.4xlarge",
        "c3.8xlarge",
        "c4.xlarge",
        "c4.2xlarge",
        "c4.4xlarge",
        "c4.8xlarge",
        "g2.2xlarge",
        "g3.4xlarge",
        "g3.8xlarge",
        "g3.16xlarge",
        "p2.xlarge",
        "p2.8xlarge",
        "p2.16xlarge",
        "p3.2xlarge",
        "p3.8xlarge",
        "p3.16xlarge",
        "i2.xlarge",
        "i2.2xlarge",
        "i2.4xlarge",
        "i2.8xlarge",
        "r3.xlarge",
        "r3.2xlarge",
        "r3.4xlarge",
        "r3.8xlarge",
        "r4.xlarge",
        "r4.2xlarge",
        "r4.4xlarge",
        "r4.8xlarge",
        "r4.16xlarge"
      ]
    },
    "NumberOfCoreInstances":{
      "Description":"Must be a valid number",
      "Type":"Number",
      "Default":2
    },
    "SubnetID":{
      "Type":"AWS::EC2::Subnet::Id",
      "Description":"Must be Valid public subnet ID"
    },
    "LogUri":{
      "Description":"Must be a valid S3 URL",
      "Default":"s3://aidatagov.emr01/aidatagov-logs/",
      "Type":"String"
    },
    "ReleaseLabel":{
      "Type":"String",
      "Description":"Must be a valid EMR release version",
      "AllowedValues":[
        "emr-5.24.1",
        "emr-5.24.0",
        "emr-5.23.0",
        "emr-5.22.0",
        "emr-5.21.0",
        "emr-5.20.0",
        "emr-5.19.0",
        "emr-5.18.0",
        "emr-5.17.0",
        "emr-5.16.0",
        "emr-5.15.0",
        "emr-5.14.1",
        "emr-5.14.0",
        "emr-5.13.0",
        "emr-5.12.2",
        "emr-5.12.1",
        "emr-5.12.0",
        "emr-5.11.2",
        "emr-5.11.1",
        "emr-5.11.0",
        "emr-5.10.0",
        "emr-5.9.0",
        "emr-5.8.2",
        "emr-5.8.1",
        "emr-5.8.0",
        "emr-5.7.0",
        "emr-5.6.0",
        "emr-5.5.3",
        "emr-5.5.2",
        "emr-5.5.1",
        "emr-5.5.0",
        "emr-5.4.0",
        "emr-5.3.1",
        "emr-5.3.0",
        "emr-5.2.2",
        "emr-5.2.1",
        "emr-5.2.0",
        "emr-5.1.0",
        "emr-5.0.3",
        "emr-4.9.5",
        "emr-4.9.4",
        "emr-4.9.3",
        "emr-4.9.2",
        "emr-4.9.1",
        "emr-4.8.4",
        "emr-4.8.3",
        "emr-4.8.2",
        "emr-4.8.0",
        "emr-4.7.2",
        "emr-4.7.1",
        "emr-4.7.0",
        "emr-4.6.0",
        "emr-4.5.0",
        "emr-4.4.0",
        "emr-4.3.0",
        "emr-4.2.0",
        "emr-4.1.0",
        "emr-4.0.0"
      ]
    }
  },
  "Resources":{
    "EMRC4XTQZ":{
      "DependsOn":[
        "EMRClusterServiceRole",
        "EMRClusterinstanceProfileRole",
        "EMRClusterinstanceProfile"
      ],
      "Type":"AWS::EMR::Cluster",
      "Properties":{
        "Applications":[
          {
            "Name":"Hive"
          },
          {
            "Name":"Hue"
          }
        ],
        "Instances":{
          "Ec2KeyName":{
            "Ref":"KeyName"
          },
          "Ec2SubnetId":{
            "Ref":"SubnetID"
          },
          "MasterInstanceGroup":{
            "InstanceCount":1,
            "InstanceType":{
              "Ref":"CoreInstanceType"
            },
            "Market":"ON_DEMAND",
            "Name":"Master"
          },
          "CoreInstanceGroup":{
            "InstanceCount":{
              "Ref":"NumberOfCoreInstances"
            },
            "InstanceType":{
              "Ref":"CoreInstanceType"
            },
            "Market":"ON_DEMAND",
            "Name":"Core"
          },
          "TerminationProtected":false
        },
        "VisibleToAllUsers":true,
        "JobFlowRole":{
          "Ref":"EMRClusterinstanceProfile"
        },
        "ReleaseLabel":{
          "Ref":"ReleaseLabel"
        },
        "LogUri":{
          "Ref":"LogUri"
        },
        "Name":{
          "Ref":"EMRClusterName"
        },
        "ServiceRole":{
          "Ref":"EMRClusterServiceRole"
        }
      }
    },
    "EMRClusterServiceRole":{
      "Type":"AWS::IAM::Role",
      "Properties":{
        "AssumeRolePolicyDocument":{
          "Version":"2012-10-17",
          "Statement":[
            {
              "Effect":"Allow",
              "Principal":{
                "Service":[
                  "elasticmapreduce.amazonaws.com.cn"
                ]
              },
              "Action":[
                "sts:AssumeRole"
              ]
            }
          ]
        },
        "ManagedPolicyArns":[
          "arn:aws:iam::aws:policy/service-role/AmazonElasticMapReduceRole"
        ],
        "Path":"/"
      }
    },
    "EMRClusterinstanceProfileRole":{
      "Type":"AWS::IAM::Role",
      "Properties":{
        "AssumeRolePolicyDocument":{
          "Version":"2012-10-17",
          "Statement":[
            {
              "Effect":"Allow",
              "Principal":{
                "Service":[
                  "ec2.amazonaws.com.cn"
                ]
              },
              "Action":[
                "sts:AssumeRole"
              ]
            }
          ]
        },
        "ManagedPolicyArns":[
          "arn:aws:iam::aws:policy/service-role/AmazonElasticMapReduceforEC2Role"
        ],
        "Path":"/"
      }
    },
    "EMRClusterinstanceProfile":{
      "Type":"AWS::IAM::InstanceProfile",
      "Properties":{
        "Path":"/",
        "Roles":[
          {
            "Ref":"EMRClusterinstanceProfileRole"
          }
        ]
      }
    }
  },
  "Outputs":{
    
  }
}